// ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ñ‚ÑŒ ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚ ÑÐ¿Ð¸ÑÐºÑƒ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½ÑŒ, ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ Ð· ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ Ñ–ÐºÐ¾Ð½ÐºÐ°-ÑÐµÑ€Ñ†Ðµ (AddToFavorite) Ñ‚Ð° LearnMore
// ÐšÐ»Ñ–Ðº Ð¿Ð¾: 
//   - Ñ–ÐºÐ¾Ð½Ñ†Ñ–-ÑÐµÑ€Ñ†ÑŽ (AddToFavorite):
//      - ÑÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ ÐÐ’Ð¢ÐžÐ Ð˜Ð—ÐžÐ’ÐÐÐ˜Ð™ - Ð² Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ– Ð²Ñ–Ð´ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ð¸ Ð´Ð¾Ð´Ð°Ð½Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ðµ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ Ð² Ð¾Ð±Ñ€Ð°Ð½Ñ–, Ð¿Ð¾ ÐºÐ»Ñ–ÐºÑƒ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð´Ð¾Ð´Ð°Ñ” Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ Ð² Ð¾Ð±Ñ€Ð°Ð½Ñ– Ð°Ð±Ð¾ Ð²Ð¸Ð´Ð°Ð»ÑÑ” Ð· Ð½Ð¸Ñ…
//      - ÑÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ ÐÐ•ÐÐ’Ð¢ÐžÐ Ð˜Ð—ÐžÐ’ÐÐÐ˜Ð™, ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ Ð¿Ð¾Ð²Ð¸Ð½Ð½Ð¾ Ð²Ð¸Ð²Ð¾Ð´Ð¸Ñ‚Ð¸ÑÑŒ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ñ‚Ð¸Ð¿Ñƒ Ð½Ð¾Ñ‚Ñ–Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ Ð· Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ”ÑŽ Ð¿Ñ€Ð¾ Ñ‚Ðµ, Ñ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð´Ð»Ñ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ Ð´Ð°Ð½Ð¾Ð³Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»Ñƒ
//   - LearnMore - Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ” ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ Ð¼Ð¾Ð´Ð°Ð»ÐºÑƒ Ð· Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¸Ð¼ Ð¾Ð¿Ð¸ÑÐ¾Ð¼ Ð´Ð°Ð½Ð¾Ð³Ð¾ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ - NoticeModal

// ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡

// ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð´Ð»Ñ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ, ÑÐºÑ‰Ð¾ Ð´Ð°Ð½Ðµ Ð¾Ð³Ð¾Ð»Ð¾ÑˆÐµÐ½Ð½Ñ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ðµ Ñ†Ð¸Ð¼ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ÐµÐ¼. 
// ÐšÐ»Ñ–Ðº Ð¿Ð¾ ÐºÐ½Ð¾Ð¿Ñ†Ñ– Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ” Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ðµ Ð²Ñ–ÐºÐ½Ð¾  ModalApproveAction


import { Card, FavoriteBtn, DeleteBtn, CategoryTag, ImageWrapper, DescriptionWrapper, Title, Image, TagItem, TagList, MoreBtn, SvgIcon, HeartIcon, TrashIcon } from "./NoticeCategoryItem.styled";

import icon from '../../images/icons.svg';
import { useState } from "react";
import { ModalNotice } from "components/ModalNotice/ModalNotice";
import { useDispatch, useSelector } from "react-redux";
import { selectUser } from "Redux/auth/selector";
// import { getConnect, selectUser } from "Redux/auth/selector";
import { updateFavorite } from "Redux/notices/operation";
import { toast } from "react-hot-toast";

export const NoticeCategoryItem = ({onTrashModal, item}) => {

  const idUser = useSelector(selectUser).id;
  // const isLogin = useSelector(getConnect);
  const activeFavorite = item.favorite.includes(idUser);
  const noticeId = item.id
  const favorite = !activeFavorite
  const dispatch = useDispatch();
  
  const agePet = (birthday) => {
    const nowDate = new Date().getTime();
    const [day, month, year] = birthday.split('.');
    const birthDate = new Date (`${Number(year)}-${Number(month)}-${Number(day)}`).getTime();
    
    const differenceTime = nowDate - birthDate
    
    if (differenceTime < 2630016000) {
      return `${Math.floor(differenceTime/604800000)} week`
    } else if ( differenceTime < 31560192000) {
      return `${Math.floor(differenceTime/2630016000)} mos`
    } else {
      return `${Math.floor(differenceTime/31560192000)} year`
    };
  }
  
  const handleFavorite = () => {
    if (!idUser) {
      toast.error('Please authorization and try again ðŸ˜¸');
    }
    dispatch(updateFavorite({noticeId, favorite}));
  };

  const [isOpenModal, setIsOpenModal] = useState(false);

  const toggleModal = () => {
    setIsOpenModal(isOpen => !isOpen);    
  };


  return(
    <>
      <Card>
        <ImageWrapper>
          <Image alt="pet" src={item.imageURL ? item.imageURL : "https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcSgGi3YJI2iukoOZ3_fbYCyoiR4dYO8fIyIu_qpphSUf8GRAmFN"}/>
          <CategoryTag>{item.categories ? item.categories : 'categories'}</CategoryTag>
          <TagList>
            <TagItem>
              <SvgIcon height="20" width="20">
                <use href={icon + "#location"}/>
              </SvgIcon>
              <p>{item.place ? item.place : 'city'}</p>
            </TagItem>
            <TagItem>
              <SvgIcon height="20" width="20">
                <use href={icon + "#clock"}/>
              </SvgIcon>
              <p>{item.birthday ? agePet(item.birthday) : 'age'}</p>
            </TagItem>
            <TagItem>
              {item.sex === 'female'
              ?<SvgIcon height="20" width="20" sex={item.sex}>
                <use href={icon + "#female"}/>
              </SvgIcon>
              :<SvgIcon height="20" width="20" sex={item.sex}>
                <use href={icon + "#male"}/>
              </SvgIcon>
              } 
              <p>{item.sex ? item.sex : 'sex'}</p>
            </TagItem>
          </TagList>
          <FavoriteBtn onClick={()=> handleFavorite()}>
            <HeartIcon height="20" width="20" isActive={activeFavorite} style={{fill: ""}}>
              <use href={icon + "#heart"}/>
            </HeartIcon>
          </FavoriteBtn>
          <DeleteBtn onClick={onTrashModal}>
            <TrashIcon height="20" width="20" >
              <use href={icon + "#trash"}/>
            </TrashIcon>
          </DeleteBtn>
        </ImageWrapper>

        <DescriptionWrapper>
          <Title>{item.title ? item.title : 'Cute fox looking for a home'}</Title>
          <MoreBtn onClick={toggleModal}>Learn more</MoreBtn>
        </DescriptionWrapper>
        {isOpenModal&& <ModalNotice onClose={toggleModal} notice={item} noticeId={item.id}/>}
      </Card>
    </>
  )
}
